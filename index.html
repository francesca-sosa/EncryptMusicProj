<!DOCTYPE html>
<html>
    <head>
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    

    </head>
    <body style="">
        <canvas id="myCanvas" width="300" height="150" style="border:1px solid black;">
        </canvas>

        <script>
            //const canvas = document.querySelector("canvas");
            const canvas = document.getElementById("myCanvas");
            const ctx = canvas.getContext("2d");
            ctx.font = "50px Arial";
            ctx.fillText("Hello World",10,80);

            var current_state;
            var game_data;
            try{
                draw(game_data['states'][current_state]['text_loaded']);
            }catch(err){
            }

            $.getJSON( "tabs.json", function( data ) {
                game_data = data;
                current_state = data['start_state'];
                load_messages();
            });

            function all_loaded(){
                fillText(game_data['states']['0']['text_loaded']); 
                console.log(current_state);
                // $('#splash').hide();
                // $('#mycanvas').show();
                
            }

            function load_messages(){
                for (var key in game_data['states']){
                    if(game_data['states'][key]['text'] != null){
                        console.log( key, game_data['states'][key]['text'] );
                        game_data['states'][key]['text_loaded'] = new String();
                        game_data['states'][key]['text_loaded'].src = game_data['states'][key]['text']; 
                    }
                }
                all_loaded();
            }

            const up_arrow = 38;
            const down_arrow = 40;
            const left_arrow = 37;
            const right_arrow = 39;

            var cur_pos_x = 0;
            var cur_pos_y = 0;


            document.body.onkeydown = function(e){
                if(e.keyCode == up_arrow){
                    cur_pos_x = cur_pos_x +1;
                }
            //alert(String.fromCharCode(e.keyCode)+" --> "+e.keyCode);
                key_input(e.keyCode)

            };

            function key_input(what_key){
                for(i=0; i< game_data['states'][current_state]['next_state'].length; i++){
                    if( what_key == game_data['states'][current_state]['next_state'][i]['key_input']) {
                        if ( typeof game_data['states'][current_state]['next_state'][i]['state_name'] == "string"){
                        next_state(game_data['states'][current_state]['next_state'][i]['state_name'])
                        }
                        break
                    } 
                }

                console.log(what_key);
            }

            function next_state( state) {
                console.log("Current State = " + current_state + " --> New State= " + state) 
                current_state = state

                draw(game_data['states'][current_state]['text_loaded'])
                if(game_data['states'][current_state]['other_text'] != null){
                    for(i=0; i<game_data['states'][current_state]['other_text'].length;i++){
                        console.log( game_data['states'][current_state]['other_text'][i]['src']);
                        draw_src( game_data['states'][current_state]['other_text'][i]['src'],
                                game_data['states'][current_state]['other_text'][i]['x_cord'],
                                game_data['states'][current_state]['other_text'][i]['y_cord'],
                                game_data['states'][current_state]['other_text'][i]['width'],
                                game_data['states'][current_state]['other_text'][i]['height']);
                    }
                }
            }

            function fillText(string) {
                var ctx = canvas.getContext('2d');
                ctx.font = "50px Arial";
                ctx.fillText(string, 10, 80);
            }


        </script>
    </body>
</html>
